"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[6509],{8199:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>c,contentTitle:()=>s,default:()=>j,frontMatter:()=>i,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"forgejo/forgejo-sso","title":"Forgejo SSO","description":"Client Configuration in Keycloak","source":"@site/docs/131-forgejo/20-forgejo-sso.md","sourceDirName":"131-forgejo","slug":"/forgejo/forgejo-sso","permalink":"/nursery/forgejo/forgejo-sso","draft":false,"unlisted":false,"editUrl":"https://github.com/infaloom/nursery/tree/main/docusaurus/docs/131-forgejo/20-forgejo-sso.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"Forgejo","permalink":"/nursery/forgejo/setup-forgejo"},"next":{"title":"Woodpecker CI","permalink":"/nursery/woodpecker/"}}');var d=r(4848),o=r(8453);const i={},s="Forgejo SSO",c={},l=[{value:"Client Configuration in Keycloak",id:"client-configuration-in-keycloak",level:2},{value:"SSO Configuration in Forgejo",id:"sso-configuration-in-forgejo",level:2}];function h(e){const n={code:"code",h1:"h1",h2:"h2",header:"header",p:"p",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,o.R)(),...e.components};return(0,d.jsxs)(d.Fragment,{children:[(0,d.jsx)(n.header,{children:(0,d.jsx)(n.h1,{id:"forgejo-sso",children:"Forgejo SSO"})}),"\n",(0,d.jsx)(n.h2,{id:"client-configuration-in-keycloak",children:"Client Configuration in Keycloak"}),"\n",(0,d.jsx)(n.p,{children:"Create client in Keycloak with the following settings:"}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Setting"}),(0,d.jsx)(n.th,{children:"Value"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Client ID"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"forgejo"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Root URL"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"https://forgejo.<CLUSTER_DOMAIN>"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Home URL"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Redirect URIs"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/user/oauth2/Keycloak/callback"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Web Origins"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/*"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Client Authentication"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Enabled"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Standard Flow"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Enabled"})})]})]})]}),"\n",(0,d.jsx)(n.p,{children:"Make note of the Client Secret generated by Keycloak, you will need it in the next step."}),"\n",(0,d.jsxs)(n.p,{children:["Add users that you want to have access to Forgejo to the ",(0,d.jsx)(n.code,{children:"Forgejo Contributors"})," group in Keycloak.\r\nUsers that should be able to administer Forgejo should be added to the ",(0,d.jsx)(n.code,{children:"Forgejo Admins"})," group in Keycloak."]}),"\n",(0,d.jsx)(n.h2,{id:"sso-configuration-in-forgejo",children:"SSO Configuration in Forgejo"}),"\n",(0,d.jsxs)(n.p,{children:["Sign in to Forgejo with the default admin account and go to ",(0,d.jsx)(n.code,{children:"Site Administration > Identity & access > Authentication sources"})," and add a new authentication source with the following settings. Replace ",(0,d.jsx)(n.code,{children:"<CLIENT_SECRET>"})," and ",(0,d.jsx)(n.code,{children:"<CLUSTER_DOMAIN>"})," with actual values."]}),"\n",(0,d.jsxs)(n.p,{children:["This guide assumes that you have already configured ",(0,d.jsx)(n.code,{children:"Nursery"})," realm."]}),"\n",(0,d.jsxs)(n.table,{children:[(0,d.jsx)(n.thead,{children:(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.th,{children:"Setting"}),(0,d.jsx)(n.th,{children:"Value"})]})}),(0,d.jsxs)(n.tbody,{children:[(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Authentication Type"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"OAuth2"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Name"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Keycloak"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"OAuth2 Provider"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"OpenID Connect"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Client ID"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"forgejo"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Client Secret"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"<CLIENT_SECRET>"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"OpenID Connect Auto Discovery URL"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"https://account.<CLUSTER_DOMAIN>/realms/nursery/.well-known/openid-configuration"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Skip local 2FA"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Enabled"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Required claim name"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"groups"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Required claim value"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/Forgejo Contributors"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Claim name providing group names for this source"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"groups"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Group claim value for administrator users"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"/Forgejo Admins"})})]}),(0,d.jsxs)(n.tr,{children:[(0,d.jsx)(n.td,{children:"Activated"}),(0,d.jsx)(n.td,{children:(0,d.jsx)(n.code,{children:"Enabled"})})]})]})]})]})}function j(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,d.jsx)(n,{...e,children:(0,d.jsx)(h,{...e})}):h(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>i,x:()=>s});var t=r(6540);const d={},o=t.createContext(d);function i(e){const n=t.useContext(o);return t.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function s(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(d):e.components||d:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);