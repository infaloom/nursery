"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[4157],{8084:(e,a,n)=>{n.r(a),n.d(a,{assets:()=>o,contentTitle:()=>r,default:()=>p,frontMatter:()=>t,metadata:()=>s,toc:()=>i});const s=JSON.parse('{"id":"keycloak/index","title":"Keycloak","description":"Keycloak is an open-source identity and access management solution aimed at modern applications and services. It provides features such as single sign-on (SSO), user federation, identity brokering, and social login. Keycloak supports standard protocols like OAuth2, OpenID Connect, and SAML 2.0, making it a versatile choice for managing authentication and authorization in various environments.","source":"@site/docs/105-keycloak/index.md","sourceDirName":"105-keycloak","slug":"/keycloak/","permalink":"/nursery/keycloak/","draft":false,"unlisted":false,"editUrl":"https://github.com/infaloom/nursery/tree/main/docusaurus/docs/105-keycloak/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"CloudNativePG","permalink":"/nursery/cnpg/"},"next":{"title":"Redis","permalink":"/nursery/redis/"}}');var c=n(4848),l=n(8453);const t={},r="Keycloak",o={},i=[{value:"Database Setup",id:"database-setup",level:2},{value:"Deploy Keycloak",id:"deploy-keycloak",level:2},{value:"Access Keycloak",id:"access-keycloak",level:2},{value:"Create Realm, Clients, and Users",id:"create-realm-clients-and-users",level:2}];function d(e){const a={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,l.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(a.header,{children:(0,c.jsx)(a.h1,{id:"keycloak",children:"Keycloak"})}),"\n",(0,c.jsx)(a.p,{children:"Keycloak is an open-source identity and access management solution aimed at modern applications and services. It provides features such as single sign-on (SSO), user federation, identity brokering, and social login. Keycloak supports standard protocols like OAuth2, OpenID Connect, and SAML 2.0, making it a versatile choice for managing authentication and authorization in various environments."}),"\n",(0,c.jsx)(a.h2,{id:"database-setup",children:"Database Setup"}),"\n",(0,c.jsx)(a.p,{children:"Create openbao secret with random password:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"kubectl exec -ti openbao-0 -n openbao -- bao kv put -mount=kv keycloak-db-credentials \\\n    username=keycloak \\\n    password=$(openssl rand -base64 32)\n"})}),"\n",(0,c.jsx)(a.p,{children:"Add external secret for Keycloak database credentials:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f k8s/cnpg-system/databases/keycloak/keycloak-db-credentials-external-secret.yaml\n"})}),"\n",(0,c.jsx)(a.p,{children:"Update the cluster values to include the Keycloak role:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-yaml",children:"  roles:\n    - name: keycloak\n      ensure: present # <- this line ensures the role is created\n      login: true\n      superuser: false\n      passwordSecret:\n        name: keycloak-db-credentials\n"})}),"\n",(0,c.jsx)(a.p,{children:"Update CNPG cluster to sync keycloak role:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f k8s/cnpg-system/cnpg-cluster-values.yaml\n"})}),"\n",(0,c.jsx)(a.p,{children:"Update CNPG cluster to sync keycloak role (ensure environment variables are set):"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"envsubst < k8s/cnpg-system/cnpg-cluster-values.yaml | \\\nhelm upgrade --install cnpg-cluster cnpg/cluster \\\n--version 0.2.1 \\\n--namespace cnpg-system --create-namespace \\\n--values -\n"})}),"\n",(0,c.jsx)(a.p,{children:"Create Keycloak database:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f k8s/cnpg-system/databases/keycloak/keycloak-database.yaml\n"})}),"\n",(0,c.jsx)(a.h2,{id:"deploy-keycloak",children:"Deploy Keycloak"}),"\n",(0,c.jsx)(a.p,{children:"Apply Keycloak namespace:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f k8s/keycloak/keycloak-namespace.yaml\n"})}),"\n",(0,c.jsx)(a.p,{children:"Apply config secret for Keycloak:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"envsubst < k8s/keycloak/keycloak-config-external-secret.yaml | kubectl apply -f -\n"})}),"\n",(0,c.jsx)(a.p,{children:"Apply Keycloak deployment:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"kubectl apply -f k8s/keycloak/keycloak.yaml\n"})}),"\n",(0,c.jsx)(a.p,{children:"Apply Keycloak ingress:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"envsubst < k8s/keycloak/keycloak-ingress.yaml | kubectl apply -f -\n"})}),"\n",(0,c.jsx)(a.p,{children:"Apply Keycloak admin ingress:"}),"\n",(0,c.jsx)(a.pre,{children:(0,c.jsx)(a.code,{className:"language-bash",children:"envsubst < k8s/keycloak/keycloak-admin-ingress.yaml | kubectl apply -f -\n"})}),"\n",(0,c.jsx)(a.h2,{id:"access-keycloak",children:"Access Keycloak"}),"\n",(0,c.jsxs)(a.p,{children:["You can access the Keycloak user account console at: ",(0,c.jsx)(a.code,{children:"https://account.${CLUSTER_DOMAIN}"})]}),"\n",(0,c.jsxs)(a.p,{children:["You can access the Keycloak admin console at: ",(0,c.jsx)(a.code,{children:"https://keycloak.${CLUSTER_DOMAIN}"})]}),"\n",(0,c.jsxs)(a.p,{children:["The default admin username is ",(0,c.jsx)(a.code,{children:"admin"})," and the password is ",(0,c.jsx)(a.code,{children:"admin"}),". Create a proper admin user immediately after your first login and delete the default admin user to ensure the security of your Keycloak instance."]}),"\n",(0,c.jsx)(a.h2,{id:"create-realm-clients-and-users",children:"Create Realm, Clients, and Users"}),"\n",(0,c.jsxs)(a.p,{children:["You need to create a new realm, clients, and users as needed for your applications. The detailed config is beyond the scope of this documentation, but you can refer to the ",(0,c.jsx)(a.a,{href:"https://www.keycloak.org/documentation",children:"Keycloak Documentation"})," for guidance on how to set up realms, clients, and users according to your requirements."]})]})}function p(e={}){const{wrapper:a}={...(0,l.R)(),...e.components};return a?(0,c.jsx)(a,{...e,children:(0,c.jsx)(d,{...e})}):d(e)}},8453:(e,a,n)=>{n.d(a,{R:()=>t,x:()=>r});var s=n(6540);const c={},l=s.createContext(c);function t(e){const a=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(a):{...a,...e}},[a,e])}function r(e){let a;return a=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:t(e.components),s.createElement(l.Provider,{value:a},e.children)}}}]);