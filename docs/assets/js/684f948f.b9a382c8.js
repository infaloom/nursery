"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[8218],{5863:(e,r,o)=>{o.r(r),o.d(r,{assets:()=>c,contentTitle:()=>l,default:()=>g,frontMatter:()=>t,metadata:()=>n,toc:()=>i});const n=JSON.parse('{"id":"forgejo/index","title":"Forgejo","description":"Forgejo is a community-driven, lightweight code hosting solution that is a fork of Gitea. It provides a simple and efficient platform for managing Git repositories, making it easy for developers to collaborate on projects.","source":"@site/docs/131-forgejo/index.md","sourceDirName":"131-forgejo","slug":"/forgejo/","permalink":"/nursery/forgejo/","draft":false,"unlisted":false,"editUrl":"https://github.com/infaloom/nursery/tree/main/docusaurus/docs/131-forgejo/index.md","tags":[],"version":"current","frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"ArgoCD","permalink":"/nursery/argocd/"},"next":{"title":"Woodpecker CI","permalink":"/nursery/woodpecker/"}}');var a=o(4848),s=o(8453);const t={},l="Forgejo",c={},i=[{value:"Create CNPG Database",id:"create-cnpg-database",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Install Forgejo",id:"install-forgejo",level:2}];function d(e){const r={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(r.header,{children:(0,a.jsx)(r.h1,{id:"forgejo",children:"Forgejo"})}),"\n",(0,a.jsxs)(r.p,{children:[(0,a.jsx)(r.a,{href:"https://forgejo.org/",children:"Forgejo"})," is a community-driven, lightweight code hosting solution that is a fork of Gitea. It provides a simple and efficient platform for managing Git repositories, making it easy for developers to collaborate on projects."]}),"\n",(0,a.jsx)(r.p,{children:(0,a.jsx)(r.a,{href:"https://code.forgejo.org/forgejo-helm/forgejo-helm",children:"https://code.forgejo.org/forgejo-helm/forgejo-helm"})}),"\n",(0,a.jsx)(r.h2,{id:"create-cnpg-database",children:"Create CNPG Database"}),"\n",(0,a.jsx)(r.p,{children:"Create openbao secret with random password:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"kubectl exec -ti openbao-0 -n openbao -- bao kv put -mount=kv forgejo-db-credentials \\\r\n    username=forgejo \\\r\n    password=$(openssl rand -base64 32)\n"})}),"\n",(0,a.jsx)(r.p,{children:"Add external secret for Forgejo database credentials:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"kubectl apply -f k8s/cnpg-system/databases/forgejo/forgejo-db-credentials-external-secret.yaml\n"})}),"\n",(0,a.jsx)(r.p,{children:"Update the cluster values to include the Forgejo role:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-yaml",children:"  roles:\r\n    - name: forgejo\r\n      ensure: present # <- this line ensures the role is created\r\n      login: true\r\n      superuser: false\r\n      passwordSecret:\r\n        name: forgejo-db-credentials\n"})}),"\n",(0,a.jsx)(r.p,{children:"Update CNPG cluster to sync forgejo role (ensure environment variables are set):"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"envsubst < k8s/cnpg-system/cnpg-cluster-values.yaml | \\\r\nhelm upgrade --install cnpg-cluster cnpg/cluster \\\r\n--version 0.2.1 \\\r\n--namespace cnpg-system --create-namespace \\\r\n--values -\n"})}),"\n",(0,a.jsx)(r.p,{children:"Create Forgejo database:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"kubectl apply -f k8s/cnpg-system/databases/forgejo/forgejo-database.yaml\n"})}),"\n",(0,a.jsx)(r.h2,{id:"configuration",children:"Configuration"}),"\n",(0,a.jsx)(r.p,{children:"Create namespace for Forgejo:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"kubectl apply -f k8s/forgejo/forgejo-namespace.yaml\n"})}),"\n",(0,a.jsx)(r.p,{children:"Create Object Bucket Claim for Forgejo:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"kubectl apply -f k8s/forgejo/forgejo-bucket-claim.yaml\n"})}),"\n",(0,a.jsx)(r.p,{children:"Add forgejo-db-credentials external secret in forgejo namespace:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"kubectl apply -f k8s/forgejo/forgejo-db-credentials-external-secret.yaml\n"})}),"\n",(0,a.jsx)(r.h2,{id:"install-forgejo",children:"Install Forgejo"}),"\n",(0,a.jsx)(r.p,{children:"Install Forgejo with Helm:"}),"\n",(0,a.jsx)(r.pre,{children:(0,a.jsx)(r.code,{className:"language-bash",children:"envsubst < k8s/forgejo/values.yaml | \\\r\n  helm upgrade --install forgejo oci://code.forgejo.org/forgejo-helm/forgejo \\\r\n  --version 15.0.3 \\\r\n  --namespace forgejo --create-namespace \\\r\n  --values -\n"})})]})}function g(e={}){const{wrapper:r}={...(0,s.R)(),...e.components};return r?(0,a.jsx)(r,{...e,children:(0,a.jsx)(d,{...e})}):d(e)}},8453:(e,r,o)=>{o.d(r,{R:()=>t,x:()=>l});var n=o(6540);const a={},s=n.createContext(a);function t(e){const r=n.useContext(s);return n.useMemo(function(){return"function"==typeof e?e(r):{...r,...e}},[r,e])}function l(e){let r;return r=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:t(e.components),n.createElement(s.Provider,{value:r},e.children)}}}]);