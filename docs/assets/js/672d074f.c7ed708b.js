"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[2913],{8453:(e,o,r)=>{r.d(o,{R:()=>a,x:()=>s});var c=r(6540);const n={},t=c.createContext(n);function a(e){const o=c.useContext(t);return c.useMemo(function(){return"function"==typeof e?e(o):{...o,...e}},[o,e])}function s(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:a(e.components),c.createElement(t.Provider,{value:o},e.children)}},8804:(e,o,r)=>{r.r(o),r.d(o,{assets:()=>d,contentTitle:()=>s,default:()=>u,frontMatter:()=>a,metadata:()=>c,toc:()=>i});const c=JSON.parse('{"id":"argocd/argocd-sso","title":"ArgoCD SSO","description":"Follow the instructions in the ArgoCD Keycloak SSO guide to set up Keycloak as an OIDC provider for ArgoCD.","source":"@site/docs/130-argocd/20-argocd-sso.md","sourceDirName":"130-argocd","slug":"/argocd/argocd-sso","permalink":"/nursery/argocd/argocd-sso","draft":false,"unlisted":false,"editUrl":"https://github.com/infaloom/nursery/tree/main/docusaurus/docs/130-argocd/20-argocd-sso.md","tags":[],"version":"current","sidebarPosition":20,"frontMatter":{},"sidebar":"defaultSidebar","previous":{"title":"Setup ArgoCD","permalink":"/nursery/argocd/setup-argocd"},"next":{"title":"Forgejo","permalink":"/nursery/forgejo/setup-forgejo"}}');var n=r(4848),t=r(8453);const a={},s="ArgoCD SSO",d={},i=[];function l(e){const o={a:"a",admonition:"admonition",code:"code",h1:"h1",header:"header",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(o.header,{children:(0,n.jsx)(o.h1,{id:"argocd-sso",children:"ArgoCD SSO"})}),"\n",(0,n.jsxs)(o.p,{children:["Follow the instructions in the ",(0,n.jsx)(o.a,{href:"https://argo-cd.readthedocs.io/en/release-2.14/operator-manual/user-management/keycloak/#keycloak-and-argocd-with-client-authentication",children:"ArgoCD Keycloak SSO guide"})," to set up Keycloak as an OIDC provider for ArgoCD."]}),"\n",(0,n.jsxs)(o.p,{children:["Export ",(0,n.jsx)(o.code,{children:"REPLACE_WITH_CLIENT_SECRET"})," with the client secret you obtained when creating the ArgoCD client in Keycloak."]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:"export REPLACE_WITH_CLIENT_SECRET=<your-client-secret>\n"})}),"\n",(0,n.jsxs)(o.p,{children:["Update ",(0,n.jsx)(o.code,{children:"argocd-secret"})," to set the OIDC client secret:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:'kubectl -n argocd patch secret argocd-secret --patch="{\\"stringData\\": { \\"oidc.keycloak.clientSecret\\": \\"$REPLACE_WITH_CLIENT_SECRET\\" }}"\n'})}),"\n",(0,n.jsxs)(o.p,{children:["Update ",(0,n.jsx)(o.code,{children:"argocd-cm"})," configmap to use Keycloak OIDC:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:'kubectl -n argocd patch configmap argocd-cm --patch="{\\"data\\": {\r\n    \\"url\\": \\"https://argocd.${CLUSTER_DOMAIN}\\",\r\n    \\"oidc.config\\": \\"name: Keycloak\\nissuer: https://account.${CLUSTER_DOMAIN}/realms/nursery\\nclientID: argocd\\nrequestedScopes: [\\\\\\"openid\\\\\\"]\\nclientSecret: \\$oidc.keycloak.clientSecret\\"\r\n}}"\n'})}),"\n",(0,n.jsxs)(o.p,{children:["Update ",(0,n.jsx)(o.code,{children:"argocd-rbac-cm"})," configmap to map Keycloak groups to ArgoCD roles:"]}),"\n",(0,n.jsx)(o.pre,{children:(0,n.jsx)(o.code,{className:"language-bash",children:'kubectl -n argocd patch configmap argocd-rbac-cm --patch="{\\"data\\": {\r\n    \\"policy.csv\\": \\"g, /Admins, role:admin\\",\r\n    \\"policy.default\\": \\"role:\'\'\\"\r\n}}"\n'})}),"\n",(0,n.jsx)(o.admonition,{type:"note",children:(0,n.jsxs)(o.p,{children:[(0,n.jsx)(o.code,{children:"role:''"})," means no access by default.\r\nYou can use ",(0,n.jsx)(o.code,{children:"role:readonly"})," to give read-only access by default."]})})]})}function u(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,n.jsx)(o,{...e,children:(0,n.jsx)(l,{...e})}):l(e)}}}]);